<% layout("layouts/boilerplate") -%>

<main class="container">
  <div class="mt-2"><%- include("../partials/flash.ejs") %></div>
  <button class="btn btn-primary mt-4 mb-3" data-toggle="modal" data-target="#newUser">Add New User</button>

  <ul class="nav nav-tabs mb-2" id="myTab" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#interviewer" role="tab">Interviewers</a>
    </li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#incharge" role="tab">Student Incharges</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#admin" role="tab">Admin</a></li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="interviewer" role="tabpanel">
      <div class="tab-content" id="nav-tabContent">
        <ul class="nav nav-tabs mt-3 mb-2" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#interviewer20" role="tab"
              >20<sup>th</sup> February, 2021</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#interviewer21" role="tab">21<sup>st</sup> February, 2021</a>
          </li>
        </ul>
        <div class="tab-pane fade show active" id="interviewer20" role="tabpanel">
          <table class="table table-bordered table-hover text-center" id="interviewers">
            <thead class="bg-light">
              <tr>
                <th>Name</th>
                <th>Company</th>
                <th>Students Assigned</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach((user, index) => { interview_date = new Date(user.date); %> <%
              if(interview_date.getDate() == 20 && user.role === "Interviewer") { %>
              <tr>
                <td><%= user.name %></td>
                <td><%= user.company %></td>
                <td><%= studentsPerInterviewer[user._id] %></td>
                <td>
                  <a href="/users/<%= user._id %>" class="btn btn-sm btn-secondary">View</a>
                  <button
                    class="btn btn-sm btn-warning edit-interviewer"
                    data-toggle="modal"
                    data-name="<%= user.name %>"
                    data-id="<%= user._id %>"
                    data-company="<%= user.company%>"
                    data-target="#editInterviewer"
                  >
                    Edit
                  </button>
                  <form action="/users/<%= user._id %>" method="POST" class="d-inline">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
              <% } %> <% }); %>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade" id="interviewer21" role="tabpanel">
          <table class="table table-bordered table-hover text-center" id="interviewers">
            <thead class="bg-light">
              <tr>
                <th>Name</th>
                <th>Company</th>
                <th>Students Assigned</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach((user, index) => { interview_date = new Date(user.date); %> <%
              if(interview_date.getDate() == 21 && user.role === "Interviewer") { %>
              <tr>
                <td><%= user.name %></td>
                <td><%= user.company %></td>
                <td><%= studentsPerInterviewer[user._id] %></td>
                <td>
                  <a href="/users/<%= user._id %>" class="btn btn-sm btn-secondary">View</a>
                  <button
                    class="btn btn-sm btn-warning edit-interviewer"
                    data-toggle="modal"
                    data-name="<%= user.name %>"
                    data-id="<%= user._id %>"
                    data-company="<%= user.company%>"
                    data-target="#editInterviewer"
                  >
                    Edit
                  </button>
                  <form action="/users/<%= user._id %>" method="POST" class="d-inline">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
              <% } %> <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="incharge" role="tabpanel">
      <div class="tab-content" id="nav-tabContent">
        <ul class="nav nav-tabs mt-3 mb-2" id="myTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#incharge20" role="tab"
              >20<sup>th</sup> February, 2021</a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#incharge21" role="tab">21<sup>st</sup> February, 2021</a>
          </li>
        </ul>
        <div class="tab-pane fade show active" id="incharge20" role="tabpanel">
          <table class="table table-bordered table-hover text-center" id="interviewers">
            <thead class="bg-light">
              <tr>
                <th>Name</th>
                <th>Interviewer Assigned</th>
                <th>Interviewer Company</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody>
              <% incharges.forEach((incharge, index) => { %>
              <tr>
                <td><%= incharge.name %></td>
                <td><%= incharge.interviewer.name %></td>
                <td><%= incharge.interviewer.company %></td>
                <td>
                  <a href="/users/<%= incharge.interviewer._id %>" class="btn btn-sm btn-secondary">View</a>
                  <button
                    class="btn btn-sm btn-warning edit-interviewer"
                    data-toggle="modal"
                    data-name="<%= incharge.name %>"
                    data-id="<%= incharge._id %>"
                    data-company="<%= incharge.company%>"
                    data-target="#editUser"
                  >
                    Edit
                  </button>
                  <form action="/incharges/<%= incharge._id %>" method="POST" class="d-inline">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
        <div class="tab-pane fade" id="incharge21" role="tabpanel">
          <table class="table table-bordered table-hover text-center" id="interviewers">
            <thead class="bg-light">
              <tr>
                <th>Name</th>
                <th>Interviewer Assigned</th>
                <th>Interviewer Company</th>
                <th>View</th>
              </tr>
            </thead>
            <tbody>
              <% incharges.forEach((incharge, index) => { %>
              <tr>
                <td><%= incharge.name %></td>
                <td><%= incharge.interviewer.name %></td>
                <td><%= incharge.interviewer.company %></td>
                <td>
                  <a href="/incharges/<%= incharge._id %>" class="btn btn-sm btn-secondary">View</a>
                  <button
                    class="btn btn-sm btn-warning edit-interviewer"
                    data-toggle="modal"
                    data-name="<%= incharge.name %>"
                    data-id="<%= incharge._id %>"
                    data-company="<%= incharge.company%>"
                    data-target="#editUser"
                  >
                    Edit
                  </button>
                  <form action="/incharges/<%= incharge._id %>" method="POST" class="d-inline">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                  </form>
                </td>
              </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="admin" role="tabpanel">
      <table class="table table-bordered table-hover text-center" id="interviewers">
        <thead class="bg-light">
          <tr>
            <th>Name</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach((user, index) => { %> <% if(user.role === "Admin") { %>
          <tr>
            <td><%= user.name %></td>
          </tr>
          <% } %> <% }); %>
        </tbody>
      </table>
    </div>
  </div>
</main>

<%- include("./modals/new.ejs") %> <%- include("./modals/edit.ejs") %>
